{{ define "main" }}

<div class="post">
    <h1>{{ .Site.Title }}</h1>

    <p>
        History, photography, mathematics & fencing.
        Nothing here is to be taken too seriously. <a href="about/">(more)</a>
    </p>
</div>

<br />

{{ if .Site.Params.enablePhotos }}
<div class="image-grid image-stack">
    {{ with .Site.GetPage "/photos" }}
    {{ range first 1 (sort .Data.Pages "Date" "desc")}}

    {{ $_title := "" }}
    {{ $_Permalink := .Permalink }}

    <a href="{{ .Permalink }}">
        {{ $image := .Page.Resources.GetMatch .Params.image }}
        {{ with $image }}
        {{ $thumb := .Resize "800x" }}
        <img src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}" class="img-responsive">

        {{/* override this so we dont repeat the featured image */}}
        {{ $_title = .Title }}
        {{end}}
    </a>


    {{ with .Resources.ByType "image" }}
    {{ range . }}

    {{ $subThumb := .Resize "800x" }}

    {{/* dont render if its the featured image again */}}

    {{ if ne $_title .Title }}
    <a style="transform: 
                translateY({{ index ((slice " -" "" ) | shuffle) 0 }}{{ math.Rand | mul 50 | math.Ceil }}px)
        translateX({{ index ((slice "-" "" ) | shuffle) 0 }}{{ math.Rand | mul 50 | math.Ceil }}px) rotate({{ index
        ((slice "-" "" ) | shuffle) 0 }}{{ math.Rand | mul 8 | math.Ceil }}deg)"
        href="{{ $_Permalink }}#{{ .Title | urlize }}" title="{{ $_title }}">
        <img src="{{ $subThumb.RelPermalink }}" alt="{{ $_title }}" class="img-responsive">
    </a>
    {{ end }}

    {{ end }}
    {{ end }}

    {{ end }}
    {{ end }}
</div>
{{ end }}

<h2>Recent posts</h2>

<div class="posts-list">
    {{ with .Site.GetPage "/posts" }}
    {{ range first 3 (sort .Data.Pages "Date" "desc" (where .Pages ".Params.private" "!=" true))}}
    <div class="post">
        <div class="date">{{ .PublishDate.Format "Jan. 2, 2006" }}</div>
        <h3><a href="{{ .Permalink }}" title="{{ .Title }}">{{ .Title }}</a></h3>
        {{ .Summary }}

        {{ if .Truncated }}
        <p>
            <a href="{{ .RelPermalink }}">More…</a>
        </p>
        {{ end }}
    </div>
    {{ end }}
    {{ end }}
</div>

… Read more at <a href="{{ "posts/" | absURL }}">posts/</a>

{{ if .Site.Params.enablePhotos }}
<h2>Recent photos</h2>

<div class="image-grid">
    {{ with .Site.GetPage "/photos" }}
    {{ range first 3 (sort .Data.Pages "Date" "desc")}}

    {{ $_title := "" }}
    {{ $_Permalink := .Permalink }}

    <a href="{{ .Permalink }}" title="{{ .Title }}" class="img-link-titular">
        {{ $image := .Page.Resources.GetMatch .Params.image }}
        {{ with $image }}
        {{ $thumb := .Resize "800x" }}
        <img loading="lazy" src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}" class="img-responsive">

        {{/* override this so we dont repeat the featured image */}}
        {{ $_title = .Title }}
        {{end}}
    </a>


    {{ with .Resources.ByType "image" }}
    {{ range . }}

    {{ $subThumb := .Resize "800x" }}

    {{/* dont render if its the featured image again */}}

    {{ if ne $_title .Title }}
    <a href="{{ $_Permalink }}#{{ .Title | urlize }}" title="{{ $_title }}">
        <img loading="lazy" src="{{ $subThumb.RelPermalink }}" alt="{{ $_title }}" class="img-responsive">
    </a>
    {{ end }}

    {{ end }}
    {{ end }}

    {{ end }}
    {{ end }}
</div>
{{ end }}

{{ end }}